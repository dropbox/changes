<section>
	<div id="overview">
		<div class="page-header build-header status-{{build.status.id}} result-{{build.result.id}}">
			<div class="indicator" title="{{build.result.name}}">
				<div data-result="{{build.result.id}}"
					 data-status="{{build.status.id}}"
					 data-date-started="{{build.dateStarted}}"
					 data-estimated-duration="{{build.estimatedDuration}}"
					 radial-progress-bar>&nbsp;</div>
			</div>
			<h2>{{build.name}} <small>({{build.parent_revision.sha}})</small></h2>
		</div>

		<div class="row">
			<div class="col-lg-9 col-md-8">
				<dl class="flat">
					<dt ng-if="build.author">Author:</dt>
					<dd ng-if="build.author">{{build.author.name}} <span ng-if="build.author.email">(<a href="mailto:{{build.author.email}}">{{build.author.email}}</a>)</span></dd>
					<dt>Project:</dt>
					<dd><a href="{{build.project.link}}">{{build.project.name}}</a></dd>
					<dt ng-if="build.change">Change:</dt>
					<dd ng-if="build.change"><a href="#">{{build.change.name}}</a></dd>
					<dt>Revision:</dt>
					<dd>{{build.parent_revision.sha}}</dd>
					<dt>Status:</dt>
					<dd>{{build.status.name}} <span ng-if="build.status.id == 'finished'">({{build.result.name}})</span></dd>
					<dt ng-if="build.dateStarted">Started:</dt>
					<dd ng-if="build.dateStarted" time-since="build.dateStarted"></dd>
					<dt ng-if="build.duration">Duration:</dt>
					<dd ng-if="build.duration" duration="build.duration"></dd>
					<dt ng-if="build.external">External:</dt>
					<dd ng-if="build.external"><a href="{{ build.external.link }}">{{ build.external.label }}</a></dd>
				</dl>
			</div>
			<div class="col-lg-3 col-md-4">
				<div class="panel panel-default">
  					<div class="panel-body">
						<ul class="nav nav-small">
							<li><a href="javascript:void(0)" ng-click="retryBuild()">Retry this build</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<barchart ng-model="chartData" style="height:130px"></barchart>

		<pre ng-if="build.message" class="build-message" ng-bind-html="build.message | escape | linkify"></pre>

		<ul class="nav nav-justified nav-tabs phase-list" ng-if="phases">
			<li ng-repeat="phase in phases | orderBy:'dateStarted'" class="result-{{phase.result.id}}">
				<a href="#">{{phase.name}}</a>
			</li>
		</ul>

	</div>

	<div id="test-results">
		<div class="page-header">
			<h3>Test Results</p>
		</div>

		<div ng-if="build.status.id != 'finished'">
			<div class="progress progress-striped active">
				<div class="progress-bar" role="progressbar" style="width:100%">
					<span class="sr-only">Waiting on test results...</span>
			 	</div>
			</div>
		</div>

		<div ng-switch="testStatus">
			<div ng-switch-when="no-results">
				<p>No test failures were recorded.</p>
			</div>
			<div ng-switch-default>
				<div ng-if="testFailures.total">
					<h4>Failing Tests <small>{{ testFailures.total }} total failures</small></h4>
					<table class="table table-striped table-bordered">
						<thead>
							<tr>
								<th>&nbsp;</th>
								<th style="width:110px;text-align:center">Duration</th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="test in testFailures.tests">
								<td>
									<a href="{{ test.link }}">{{ test.name }}</a><br>
									<small>{{ test.package }}</small>
								</td>
								<td style="text-align:center" duration="test.duration"></td>
							</tr>
						</tbody>
					</table>

					<h4>All Tests</h4>
				</div>

				<table class="table table-striped table-bordered" ng-if="testGroups">
					<thead>
						<tr>
							<th>&nbsp;</th>
							<th style="width:110px;text-align:center">Duration</th>
							<th style="width:80px;text-align:center">Failures</th>
							<th style="width:80px;text-align:center">Total</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="testGroup in testGroups">
							<td><a href="{{ testGroup.link }}">{{ testGroup.name }}</a></td>
							<td style="text-align:center" duration="testGroup.duration"></td>
							<td style="text-align:center">{{ testGroup.numFailures }}</td>
							<td style="text-align:center">{{ testGroup.numTests }}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</section>
